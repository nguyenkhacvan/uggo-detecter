name: Nightly Release

on:
  push:
    branches:
      - '**' # Cháº¡y trÃªn má»i nhÃ¡nh (master, main, dev...)

permissions:
  contents: write # Cáº¥p quyá»n ghi Ä‘á»ƒ táº¡o/sá»­a Release

env:
  SCCACHE_GHA_ENABLED: true
  RUSTC_WRAPPER: sccache

jobs:
  build-and-release:
    name: Build & Release
    strategy:
      matrix:
        # Build cho cáº£ Windows vÃ  macOS
        include:
          - os: windows-latest
            target: x86_64-pc-windows-msvc
            artifact_name: uggo.exe
            asset_name: uggo-windows.exe
          - os: macos-latest
            target: x86_64-apple-darwin
            artifact_name: uggo
            asset_name: uggo-macos
    runs-on: ${{ matrix.os }}
    
    steps:
      - uses: actions/checkout@v4

      - id: toolchain
        uses: dtolnay/rust-toolchain@stable

      - name: Run sccache-cache
        uses: mozilla-actions/sccache-action@v0.0.4

      # Build báº£n Release tá»‘i Æ°u
      - name: Build
        run: cargo build --package uggo --release

      # Äá»•i tÃªn file Ä‘á»ƒ dá»… phÃ¢n biá»‡t khi upload
      - name: Prepare Asset
        shell: bash
        run: |
          if [ "${{ matrix.os }}" == "windows-latest" ]; then
            mv target/release/${{ matrix.artifact_name }} ${{ matrix.asset_name }}
          else
            mv target/release/${{ matrix.artifact_name }} ${{ matrix.asset_name }}
          fi

      # Tá»± Ä‘á»™ng cáº­p nháº­t vÃ o Release tÃªn lÃ  "nightly"
      - name: Update Nightly Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: nightly                 # TÃªn Tag cá»‘ Ä‘á»‹nh
          name: Development Build (Nightly) # TÃªn hiá»ƒn thá»‹ cá»§a Release
          body: |
            Báº£n build má»›i nháº¥t tá»± Ä‘á»™ng tá»« mÃ£ nguá»“n.
            ğŸ•’ Thá»i gian build: ${{ github.event.head_commit.timestamp }}
            ğŸ“ Commit: ${{ github.sha }}
          files: ${{ matrix.asset_name }}   # Upload file vá»«a Ä‘á»•i tÃªn
          prerelease: true                  # ÄÃ¡nh dáº¥u lÃ  báº£n thá»­ nghiá»‡m
          overwrite: true                   # Ghi Ä‘Ã¨ file cÅ©
